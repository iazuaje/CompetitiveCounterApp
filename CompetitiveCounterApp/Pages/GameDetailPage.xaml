<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:f="clr-namespace:Fonts"
             xmlns:pageModels="clr-namespace:CompetitiveCounterApp.PageModels"
             xmlns:models="clr-namespace:CompetitiveCounterApp.Models"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="CompetitiveCounterApp.Pages.GameDetailPage"
             x:DataType="pageModels:GameDetailPageModel"
             Title="{Binding Name}"
             Shell.BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
             Shell.ForegroundColor="{StaticResource White}"
             Shell.TitleColor="{StaticResource White}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <toolkit:InvertedBoolConverter x:Key="InvertedBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Editar"
                     Command="{Binding EditCommand}"
                     IconImageSource="{StaticResource IconEdit}" />
        <ToolbarItem Text="Eliminar"
                     Command="{Binding DeleteCommand}"
                     IconImageSource="{StaticResource IconDelete}" />
    </ContentPage.ToolbarItems>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <VerticalStackLayout Spacing="10">
                <Label Text="Color del Juego"
                       FontSize="16"
                       FontAttributes="Bold" />

                <Border StrokeThickness="0"
                        WidthRequest="80"
                        HeightRequest="80"
                        HorizontalOptions="Start"
                        Background="{Binding Game.CurrentGameColor}">
                    <Border.StrokeShape>
                        <Ellipse />
                    </Border.StrokeShape>
                </Border>
            </VerticalStackLayout>

            <VerticalStackLayout Spacing="10">
                <Label Text="Icono del Juego"
                       FontSize="16"
                       FontAttributes="Bold" />
                
                <Border BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray900}}"
                        StrokeThickness="2"
                        Stroke="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                        Padding="15"
                        WidthRequest="80"
                        HeightRequest="80"
                        HorizontalOptions="Start">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="8" />
                    </Border.StrokeShape>
                    <Image>
                        <Image.Source>
                            <FontImageSource Glyph="{Binding SelectedIcon.Icon}" 
                                           FontFamily="{Static f:FluentUI.FontFamily}" 
                                           Color="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"
                                           Size="40">
                            </FontImageSource>
                        </Image.Source>
                    </Image>
                </Border>
            </VerticalStackLayout>

            <VerticalStackLayout Spacing="10">
                <Label Text="Nombre del Juego"
                       FontSize="16"
                       FontAttributes="Bold" />
                <Label Text="{Binding Name}"
                       FontSize="20"
                       FontAttributes="Bold" />
            </VerticalStackLayout>

            <VerticalStackLayout Spacing="10">
                <Label Text="Descripcion"
                       FontSize="16"
                       FontAttributes="Bold" />
                <Label Text="{Binding Description}"
                       FontSize="14"
                       TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}" />
            </VerticalStackLayout>

            <BoxView HeightRequest="1"
                     Color="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray700}}"
                     Margin="0,10" />

            <VerticalStackLayout Spacing="15">
                <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                    <Label Text="Sesiones de Juego"
                           FontSize="18"
                           FontAttributes="Bold"
                           VerticalOptions="Center"
                           HorizontalOptions="Start" />
                    <Button Text="+ Nueva Sesion"
                            Command="{Binding AddSessionCommand}"
                            BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                            TextColor="White"
                            Padding="10,5"
                            FontSize="14"
                            CornerRadius="8" />
                </HorizontalStackLayout>

                <VerticalStackLayout Spacing="10"
                                   BindableLayout.ItemsSource="{Binding Sessions}">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="models:Session">
                            <Border BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray900}}"
                                    StrokeThickness="0"
                                    Padding="15">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="8" />
                                </Border.StrokeShape>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding BindingContext.NavigateToSessionCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                                          CommandParameter="{Binding .}" />
                                </Border.GestureRecognizers>

                                <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="5">
                                    <Label Grid.Row="0"
                                           FontSize="16"
                                           FontAttributes="Bold">
                                        <Label.Text>
                                            <MultiBinding StringFormat="{}{0:dd/MM/yyyy HH:mm}">
                                                <Binding Path="SessionDate" />
                                            </MultiBinding>
                                        </Label.Text>
                                    </Label>

                                    <Label Grid.Row="1"
                                           FontSize="14"
                                           TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}">
                                        <Label.Text>
                                            <MultiBinding StringFormat="{}{0} jugador(es)">
                                                <Binding Path="SessionPlayers.Count" />
                                            </MultiBinding>
                                        </Label.Text>
                                    </Label>

                                    <Label Grid.Row="2"
                                           Text="{Binding Notes}"
                                           FontSize="12"
                                           TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray500}}"
                                           LineBreakMode="TailTruncation"
                                           MaxLines="1" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                    <BindableLayout.EmptyView>
                        <Label Text="No hay sesiones registradas aun"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"
                               HorizontalOptions="Center"
                               Margin="0,20" />
                    </BindableLayout.EmptyView>
                </VerticalStackLayout>
            </VerticalStackLayout>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>